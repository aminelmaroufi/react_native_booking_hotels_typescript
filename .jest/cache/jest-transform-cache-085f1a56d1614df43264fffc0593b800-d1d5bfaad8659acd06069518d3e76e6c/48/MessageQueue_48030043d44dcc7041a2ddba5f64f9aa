b91c203f012c9a23e6a225f8468434eb
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var ErrorUtils = require('../vendor/core/ErrorUtils');
var Systrace = require('../Performance/Systrace');
var deepFreezeAndThrowOnMutationInDev = require('../Utilities/deepFreezeAndThrowOnMutationInDev');
var invariant = require('invariant');
var stringifySafe = require('../Utilities/stringifySafe').default;
var warnOnce = require('../Utilities/warnOnce');
var TO_JS = 0;
var TO_NATIVE = 1;
var MODULE_IDS = 0;
var METHOD_IDS = 1;
var PARAMS = 2;
var MIN_TIME_BETWEEN_FLUSHES_MS = 5;
var TRACE_TAG_REACT_APPS = 1 << 17;
var DEBUG_INFO_LIMIT = 32;
var MessageQueue = function () {
  function MessageQueue() {
    (0, _classCallCheck2.default)(this, MessageQueue);
    this._lazyCallableModules = {};
    this._queue = [[], [], [], 0];
    this._successCallbacks = new Map();
    this._failureCallbacks = new Map();
    this._callID = 0;
    this._lastFlush = 0;
    this._eventLoopStartTime = Date.now();
    this._reactNativeMicrotasksCallback = null;
    if (__DEV__) {
      this._debugInfo = {};
      this._remoteModuleTable = {};
      this._remoteMethodTable = {};
    }
    this.callFunctionReturnFlushedQueue = this.callFunctionReturnFlushedQueue.bind(this);
    this.flushedQueue = this.flushedQueue.bind(this);
    this.invokeCallbackAndReturnFlushedQueue = this.invokeCallbackAndReturnFlushedQueue.bind(this);
  }
  (0, _createClass2.default)(MessageQueue, [{
    key: "callFunctionReturnFlushedQueue",
    value: function callFunctionReturnFlushedQueue(module, method, args) {
      var _this = this;
      this.__guard(function () {
        _this.__callFunction(module, method, args);
      });
      return this.flushedQueue();
    }
  }, {
    key: "invokeCallbackAndReturnFlushedQueue",
    value: function invokeCallbackAndReturnFlushedQueue(cbID, args) {
      var _this2 = this;
      this.__guard(function () {
        _this2.__invokeCallback(cbID, args);
      });
      return this.flushedQueue();
    }
  }, {
    key: "flushedQueue",
    value: function flushedQueue() {
      var _this3 = this;
      this.__guard(function () {
        _this3.__callReactNativeMicrotasks();
      });
      var queue = this._queue;
      this._queue = [[], [], [], this._callID];
      return queue[0].length ? queue : null;
    }
  }, {
    key: "getEventLoopRunningTime",
    value: function getEventLoopRunningTime() {
      return Date.now() - this._eventLoopStartTime;
    }
  }, {
    key: "registerCallableModule",
    value: function registerCallableModule(name, module) {
      this._lazyCallableModules[name] = function () {
        return module;
      };
    }
  }, {
    key: "registerLazyCallableModule",
    value: function registerLazyCallableModule(name, factory) {
      var module;
      var getValue = factory;
      this._lazyCallableModules[name] = function () {
        if (getValue) {
          module = getValue();
          getValue = null;
        }
        return module;
      };
    }
  }, {
    key: "getCallableModule",
    value: function getCallableModule(name) {
      var getValue = this._lazyCallableModules[name];
      return getValue ? getValue() : null;
    }
  }, {
    key: "callNativeSyncHook",
    value: function callNativeSyncHook(moduleID, methodID, params, onFail, onSucc) {
      if (__DEV__) {
        invariant(global.nativeCallSyncHook, 'Calling synchronous methods on native ' + 'modules is not supported in Chrome.\n\n Consider providing alternative ' + 'methods to expose this method in debug mode, e.g. by exposing constants ' + 'ahead-of-time.');
      }
      this.processCallbacks(moduleID, methodID, params, onFail, onSucc);
      return global.nativeCallSyncHook(moduleID, methodID, params);
    }
  }, {
    key: "processCallbacks",
    value: function processCallbacks(moduleID, methodID, params, onFail, onSucc) {
      var _this4 = this;
      if (onFail || onSucc) {
        if (__DEV__) {
          this._debugInfo[this._callID] = [moduleID, methodID];
          if (this._callID > DEBUG_INFO_LIMIT) {
            delete this._debugInfo[this._callID - DEBUG_INFO_LIMIT];
          }
          if (this._successCallbacks.size > 500) {
            var info = {};
            this._successCallbacks.forEach(function (_, callID) {
              var debug = _this4._debugInfo[callID];
              var module = debug && _this4._remoteModuleTable[debug[0]];
              var method = debug && _this4._remoteMethodTable[debug[0]][debug[1]];
              info[callID] = {
                module: module,
                method: method
              };
            });
            warnOnce('excessive-number-of-pending-callbacks', "Please report: Excessive number of pending callbacks: " + this._successCallbacks.size + ". Some pending callbacks that might have leaked by never being called from native code: " + stringifySafe(info));
          }
        }
        onFail && params.push(this._callID << 1);
        onSucc && params.push(this._callID << 1 | 1);
        this._successCallbacks.set(this._callID, onSucc);
        this._failureCallbacks.set(this._callID, onFail);
      }
      if (__DEV__) {
        global.nativeTraceBeginAsyncFlow && global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS, 'native', this._callID);
      }
      this._callID++;
    }
  }, {
    key: "enqueueNativeCall",
    value: function enqueueNativeCall(moduleID, methodID, params, onFail, onSucc) {
      this.processCallbacks(moduleID, methodID, params, onFail, onSucc);
      this._queue[MODULE_IDS].push(moduleID);
      this._queue[METHOD_IDS].push(methodID);
      if (__DEV__) {
        var isValidArgument = function isValidArgument(val) {
          switch (typeof val) {
            case 'undefined':
            case 'boolean':
            case 'string':
              return true;
            case 'number':
              return isFinite(val);
            case 'object':
              if (val == null) {
                return true;
              }
              if (Array.isArray(val)) {
                return val.every(isValidArgument);
              }
              for (var k in val) {
                if (typeof val[k] !== 'function' && !isValidArgument(val[k])) {
                  return false;
                }
              }
              return true;
            case 'function':
              return false;
            default:
              return false;
          }
        };
        var replacer = function replacer(key, val) {
          var t = typeof val;
          if (t === 'function') {
            return '<<Function ' + val.name + '>>';
          } else if (t === 'number' && !isFinite(val)) {
            return '<<' + val.toString() + '>>';
          } else {
            return val;
          }
        };
        invariant(isValidArgument(params), '%s is not usable as a native method argument', JSON.stringify(params, replacer));
        deepFreezeAndThrowOnMutationInDev(params);
      }
      this._queue[PARAMS].push(params);
      var now = Date.now();
      if (global.nativeFlushQueueImmediate && now - this._lastFlush >= MIN_TIME_BETWEEN_FLUSHES_MS) {
        var queue = this._queue;
        this._queue = [[], [], [], this._callID];
        this._lastFlush = now;
        global.nativeFlushQueueImmediate(queue);
      }
      Systrace.counterEvent('pending_js_to_native_queue', this._queue[0].length);
      if (__DEV__ && this.__spy && isFinite(moduleID)) {
        this.__spy({
          type: TO_NATIVE,
          module: this._remoteModuleTable[moduleID],
          method: this._remoteMethodTable[moduleID][methodID],
          args: params
        });
      } else if (this.__spy) {
        this.__spy({
          type: TO_NATIVE,
          module: moduleID + '',
          method: methodID,
          args: params
        });
      }
    }
  }, {
    key: "createDebugLookup",
    value: function createDebugLookup(moduleID, name, methods) {
      if (__DEV__) {
        this._remoteModuleTable[moduleID] = name;
        this._remoteMethodTable[moduleID] = methods || [];
      }
    }
  }, {
    key: "setReactNativeMicrotasksCallback",
    value: function setReactNativeMicrotasksCallback(fn) {
      this._reactNativeMicrotasksCallback = fn;
    }
  }, {
    key: "__guard",
    value: function __guard(fn) {
      if (this.__shouldPauseOnThrow()) {
        fn();
      } else {
        try {
          fn();
        } catch (error) {
          ErrorUtils.reportFatalError(error);
        }
      }
    }
  }, {
    key: "__shouldPauseOnThrow",
    value: function __shouldPauseOnThrow() {
      return typeof DebuggerInternal !== 'undefined' && DebuggerInternal.shouldPauseOnThrow === true;
    }
  }, {
    key: "__callReactNativeMicrotasks",
    value: function __callReactNativeMicrotasks() {
      Systrace.beginEvent('JSTimers.callReactNativeMicrotasks()');
      if (this._reactNativeMicrotasksCallback != null) {
        this._reactNativeMicrotasksCallback();
      }
      Systrace.endEvent();
    }
  }, {
    key: "__callFunction",
    value: function __callFunction(module, method, args) {
      this._lastFlush = Date.now();
      this._eventLoopStartTime = this._lastFlush;
      if (__DEV__ || this.__spy) {
        Systrace.beginEvent(module + "." + method + "(" + stringifySafe(args) + ")");
      } else {
        Systrace.beginEvent(module + "." + method + "(...)");
      }
      if (this.__spy) {
        this.__spy({
          type: TO_JS,
          module: module,
          method: method,
          args: args
        });
      }
      var moduleMethods = this.getCallableModule(module);
      invariant(!!moduleMethods, "Module " + module + " is not a registered callable module (calling " + method + "). A frequent cause of the error is that the application entry file path is incorrect.\n      This can also happen when the JS bundle is corrupt or there is an early initialization error when loading React Native.");
      invariant(!!moduleMethods[method], "Method " + method + " does not exist on module " + module);
      moduleMethods[method].apply(moduleMethods, args);
      Systrace.endEvent();
    }
  }, {
    key: "__invokeCallback",
    value: function __invokeCallback(cbID, args) {
      this._lastFlush = Date.now();
      this._eventLoopStartTime = this._lastFlush;
      var callID = cbID >>> 1;
      var isSuccess = cbID & 1;
      var callback = isSuccess ? this._successCallbacks.get(callID) : this._failureCallbacks.get(callID);
      if (__DEV__) {
        var debug = this._debugInfo[callID];
        var _module = debug && this._remoteModuleTable[debug[0]];
        var method = debug && this._remoteMethodTable[debug[0]][debug[1]];
        invariant(callback, "No callback found with cbID " + cbID + " and callID " + callID + " for " + (method ? " " + _module + "." + method + " - most likely the callback was already invoked" : "module " + (_module || '<unknown>')) + (". Args: '" + stringifySafe(args) + "'"));
        var profileName = debug ? '<callback for ' + _module + '.' + method + '>' : cbID;
        if (callback && this.__spy) {
          this.__spy({
            type: TO_JS,
            module: null,
            method: profileName,
            args: args
          });
        }
        Systrace.beginEvent("MessageQueue.invokeCallback(" + profileName + ", " + stringifySafe(args) + ")");
      }
      if (!callback) {
        return;
      }
      this._successCallbacks.delete(callID);
      this._failureCallbacks.delete(callID);
      callback.apply(void 0, (0, _toConsumableArray2.default)(args));
      if (__DEV__) {
        Systrace.endEvent();
      }
    }
  }], [{
    key: "spy",
    value: function spy(spyOrToggle) {
      if (spyOrToggle === true) {
        MessageQueue.prototype.__spy = function (info) {
          console.log((info.type === TO_JS ? 'N->JS' : 'JS->N') + " : " + ("" + (info.module != null ? info.module + '.' : '') + info.method) + ("(" + JSON.stringify(info.args) + ")"));
        };
      } else if (spyOrToggle === false) {
        MessageQueue.prototype.__spy = null;
      } else {
        MessageQueue.prototype.__spy = spyOrToggle;
      }
    }
  }]);
  return MessageQueue;
}();
module.exports = MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX2NyZWF0ZUNsYXNzMiIsIkVycm9yVXRpbHMiLCJTeXN0cmFjZSIsImRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldiIsImludmFyaWFudCIsInN0cmluZ2lmeVNhZmUiLCJkZWZhdWx0Iiwid2Fybk9uY2UiLCJUT19KUyIsIlRPX05BVElWRSIsIk1PRFVMRV9JRFMiLCJNRVRIT0RfSURTIiwiUEFSQU1TIiwiTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TIiwiVFJBQ0VfVEFHX1JFQUNUX0FQUFMiLCJERUJVR19JTkZPX0xJTUlUIiwiTWVzc2FnZVF1ZXVlIiwiX2xhenlDYWxsYWJsZU1vZHVsZXMiLCJfcXVldWUiLCJfc3VjY2Vzc0NhbGxiYWNrcyIsIk1hcCIsIl9mYWlsdXJlQ2FsbGJhY2tzIiwiX2NhbGxJRCIsIl9sYXN0Rmx1c2giLCJfZXZlbnRMb29wU3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsIl9yZWFjdE5hdGl2ZU1pY3JvdGFza3NDYWxsYmFjayIsIl9fREVWX18iLCJfZGVidWdJbmZvIiwiX3JlbW90ZU1vZHVsZVRhYmxlIiwiX3JlbW90ZU1ldGhvZFRhYmxlIiwiY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlIiwiYmluZCIsImZsdXNoZWRRdWV1ZSIsImludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlIiwia2V5IiwidmFsdWUiLCJtb2R1bGUiLCJtZXRob2QiLCJhcmdzIiwiX3RoaXMiLCJfX2d1YXJkIiwiX19jYWxsRnVuY3Rpb24iLCJjYklEIiwiX3RoaXMyIiwiX19pbnZva2VDYWxsYmFjayIsIl90aGlzMyIsIl9fY2FsbFJlYWN0TmF0aXZlTWljcm90YXNrcyIsInF1ZXVlIiwibGVuZ3RoIiwiZ2V0RXZlbnRMb29wUnVubmluZ1RpbWUiLCJyZWdpc3RlckNhbGxhYmxlTW9kdWxlIiwibmFtZSIsInJlZ2lzdGVyTGF6eUNhbGxhYmxlTW9kdWxlIiwiZmFjdG9yeSIsImdldFZhbHVlIiwiZ2V0Q2FsbGFibGVNb2R1bGUiLCJjYWxsTmF0aXZlU3luY0hvb2siLCJtb2R1bGVJRCIsIm1ldGhvZElEIiwicGFyYW1zIiwib25GYWlsIiwib25TdWNjIiwiZ2xvYmFsIiwibmF0aXZlQ2FsbFN5bmNIb29rIiwicHJvY2Vzc0NhbGxiYWNrcyIsIl90aGlzNCIsInNpemUiLCJpbmZvIiwiZm9yRWFjaCIsIl8iLCJjYWxsSUQiLCJkZWJ1ZyIsInB1c2giLCJzZXQiLCJuYXRpdmVUcmFjZUJlZ2luQXN5bmNGbG93IiwiZW5xdWV1ZU5hdGl2ZUNhbGwiLCJpc1ZhbGlkQXJndW1lbnQiLCJ2YWwiLCJpc0Zpbml0ZSIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiayIsInJlcGxhY2VyIiwidCIsInRvU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUiLCJjb3VudGVyRXZlbnQiLCJfX3NweSIsInR5cGUiLCJjcmVhdGVEZWJ1Z0xvb2t1cCIsIm1ldGhvZHMiLCJzZXRSZWFjdE5hdGl2ZU1pY3JvdGFza3NDYWxsYmFjayIsImZuIiwiX19zaG91bGRQYXVzZU9uVGhyb3ciLCJlcnJvciIsInJlcG9ydEZhdGFsRXJyb3IiLCJEZWJ1Z2dlckludGVybmFsIiwic2hvdWxkUGF1c2VPblRocm93IiwiYmVnaW5FdmVudCIsImVuZEV2ZW50IiwibW9kdWxlTWV0aG9kcyIsImFwcGx5IiwiaXNTdWNjZXNzIiwiY2FsbGJhY2siLCJnZXQiLCJwcm9maWxlTmFtZSIsImRlbGV0ZSIsInNweSIsInNweU9yVG9nZ2xlIiwicHJvdG90eXBlIiwiY29uc29sZSIsImxvZyIsImV4cG9ydHMiXSwic291cmNlcyI6WyJNZXNzYWdlUXVldWUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3RcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVycm9yVXRpbHMgPSByZXF1aXJlKCcuLi92ZW5kb3IvY29yZS9FcnJvclV0aWxzJyk7XG5jb25zdCBTeXN0cmFjZSA9IHJlcXVpcmUoJy4uL1BlcmZvcm1hbmNlL1N5c3RyYWNlJyk7XG5cbmNvbnN0IGRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldiA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9kZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9zdHJpbmdpZnlTYWZlJykuZGVmYXVsdDtcbmNvbnN0IHdhcm5PbmNlID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL3dhcm5PbmNlJyk7XG5cbmV4cG9ydCB0eXBlIFNweURhdGEgPSB7XG4gIHR5cGU6IG51bWJlcixcbiAgbW9kdWxlOiA/c3RyaW5nLFxuICBtZXRob2Q6IHN0cmluZyB8IG51bWJlcixcbiAgYXJnczogbWl4ZWRbXSxcbiAgLi4uXG59O1xuXG5jb25zdCBUT19KUyA9IDA7XG5jb25zdCBUT19OQVRJVkUgPSAxO1xuXG5jb25zdCBNT0RVTEVfSURTID0gMDtcbmNvbnN0IE1FVEhPRF9JRFMgPSAxO1xuY29uc3QgUEFSQU1TID0gMjtcbmNvbnN0IE1JTl9USU1FX0JFVFdFRU5fRkxVU0hFU19NUyA9IDU7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG5jb25zdCBUUkFDRV9UQUdfUkVBQ1RfQVBQUyA9IDEgPDwgMTc7XG5cbmNvbnN0IERFQlVHX0lORk9fTElNSVQgPSAzMjtcblxuY2xhc3MgTWVzc2FnZVF1ZXVlIHtcbiAgX2xhenlDYWxsYWJsZU1vZHVsZXM6IHtba2V5OiBzdHJpbmddOiAodm9pZCkgPT4gey4uLn0sIC4uLn07XG4gIF9xdWV1ZTogW251bWJlcltdLCBudW1iZXJbXSwgbWl4ZWRbXSwgbnVtYmVyXTtcbiAgX3N1Y2Nlc3NDYWxsYmFja3M6IE1hcDxudW1iZXIsID8oLi4ubWl4ZWRbXSkgPT4gdm9pZD47XG4gIF9mYWlsdXJlQ2FsbGJhY2tzOiBNYXA8bnVtYmVyLCA/KC4uLm1peGVkW10pID0+IHZvaWQ+O1xuICBfY2FsbElEOiBudW1iZXI7XG4gIF9sYXN0Rmx1c2g6IG51bWJlcjtcbiAgX2V2ZW50TG9vcFN0YXJ0VGltZTogbnVtYmVyO1xuICBfcmVhY3ROYXRpdmVNaWNyb3Rhc2tzQ2FsbGJhY2s6ID8oKSA9PiB2b2lkO1xuXG4gIF9kZWJ1Z0luZm86IHtbbnVtYmVyXTogW251bWJlciwgbnVtYmVyXSwgLi4ufTtcbiAgX3JlbW90ZU1vZHVsZVRhYmxlOiB7W251bWJlcl06IHN0cmluZywgLi4ufTtcbiAgX3JlbW90ZU1ldGhvZFRhYmxlOiB7W251bWJlcl06ICRSZWFkT25seUFycmF5PHN0cmluZz4sIC4uLn07XG5cbiAgX19zcHk6ID8oZGF0YTogU3B5RGF0YSkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzID0ge307XG4gICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgMF07XG4gICAgdGhpcy5fc3VjY2Vzc0NhbGxiYWNrcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX2NhbGxJRCA9IDA7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gMDtcbiAgICB0aGlzLl9ldmVudExvb3BTdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrID0gbnVsbDtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICB0aGlzLl9kZWJ1Z0luZm8gPSB7fTtcbiAgICAgIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZSA9IHt9O1xuICAgIH1cblxuICAgIC8vICRGbG93Rml4TWVbY2Fubm90LXdyaXRlXVxuICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICB0aGlzLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZSA9IHRoaXMuY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlLmJpbmQoXG4gICAgICB0aGlzLFxuICAgICk7XG4gICAgLy8gJEZsb3dGaXhNZVtjYW5ub3Qtd3JpdGVdXG4gICAgLy8gJEZsb3dGaXhNZVttZXRob2QtdW5iaW5kaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yIHRoaXMgcGFyYW1ldGVyc1xuICAgIHRoaXMuZmx1c2hlZFF1ZXVlID0gdGhpcy5mbHVzaGVkUXVldWUuYmluZCh0aGlzKTtcblxuICAgIC8vICRGbG93Rml4TWVbY2Fubm90LXdyaXRlXVxuICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICB0aGlzLmludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlID0gdGhpcy5pbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZS5iaW5kKFxuICAgICAgdGhpcyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBBUElzXG4gICAqL1xuXG4gIHN0YXRpYyBzcHkoc3B5T3JUb2dnbGU6IGJvb2xlYW4gfCAoKGRhdGE6IFNweURhdGEpID0+IHZvaWQpKSB7XG4gICAgaWYgKHNweU9yVG9nZ2xlID09PSB0cnVlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gaW5mbyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGAke2luZm8udHlwZSA9PT0gVE9fSlMgPyAnTi0+SlMnIDogJ0pTLT5OJ30gOiBgICtcbiAgICAgICAgICAgIGAke2luZm8ubW9kdWxlICE9IG51bGwgPyBpbmZvLm1vZHVsZSArICcuJyA6ICcnfSR7aW5mby5tZXRob2R9YCArXG4gICAgICAgICAgICBgKCR7SlNPTi5zdHJpbmdpZnkoaW5mby5hcmdzKX0pYCxcbiAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChzcHlPclRvZ2dsZSA9PT0gZmFsc2UpIHtcbiAgICAgIE1lc3NhZ2VRdWV1ZS5wcm90b3R5cGUuX19zcHkgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gc3B5T3JUb2dnbGU7XG4gICAgfVxuICB9XG5cbiAgY2FsbEZ1bmN0aW9uUmV0dXJuRmx1c2hlZFF1ZXVlKFxuICAgIG1vZHVsZTogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIGFyZ3M6IG1peGVkW10sXG4gICk6IG51bGwgfCBbQXJyYXk8bnVtYmVyPiwgQXJyYXk8bnVtYmVyPiwgQXJyYXk8bWl4ZWQ+LCBudW1iZXJdIHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2NhbGxGdW5jdGlvbihtb2R1bGUsIG1ldGhvZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5mbHVzaGVkUXVldWUoKTtcbiAgfVxuXG4gIGludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlKFxuICAgIGNiSUQ6IG51bWJlcixcbiAgICBhcmdzOiBtaXhlZFtdLFxuICApOiBudWxsIHwgW0FycmF5PG51bWJlcj4sIEFycmF5PG51bWJlcj4sIEFycmF5PG1peGVkPiwgbnVtYmVyXSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19pbnZva2VDYWxsYmFjayhjYklELCBhcmdzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmZsdXNoZWRRdWV1ZSgpO1xuICB9XG5cbiAgZmx1c2hlZFF1ZXVlKCk6IG51bGwgfCBbQXJyYXk8bnVtYmVyPiwgQXJyYXk8bnVtYmVyPiwgQXJyYXk8bWl4ZWQ+LCBudW1iZXJdIHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2NhbGxSZWFjdE5hdGl2ZU1pY3JvdGFza3MoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHF1ZXVlID0gdGhpcy5fcXVldWU7XG4gICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgdGhpcy5fY2FsbElEXTtcbiAgICByZXR1cm4gcXVldWVbMF0ubGVuZ3RoID8gcXVldWUgOiBudWxsO1xuICB9XG5cbiAgZ2V0RXZlbnRMb29wUnVubmluZ1RpbWUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gRGF0ZS5ub3coKSAtIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZTtcbiAgfVxuXG4gIHJlZ2lzdGVyQ2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nLCBtb2R1bGU6IHsuLi59KSB7XG4gICAgdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlc1tuYW1lXSA9ICgpID0+IG1vZHVsZTtcbiAgfVxuXG4gIHJlZ2lzdGVyTGF6eUNhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZywgZmFjdG9yeTogdm9pZCA9PiBpbnRlcmZhY2Uge30pIHtcbiAgICBsZXQgbW9kdWxlOiBpbnRlcmZhY2Uge307XG4gICAgbGV0IGdldFZhbHVlOiA/KHZvaWQpID0+IGludGVyZmFjZSB7fSA9IGZhY3Rvcnk7XG4gICAgdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlc1tuYW1lXSA9ICgpID0+IHtcbiAgICAgIGlmIChnZXRWYWx1ZSkge1xuICAgICAgICBtb2R1bGUgPSBnZXRWYWx1ZSgpO1xuICAgICAgICBnZXRWYWx1ZSA9IG51bGw7XG4gICAgICB9XG4gICAgICAvKiAkRmxvd0ZpeE1lW2NsYXNzLW9iamVjdC1zdWJ0eXBpbmddIGFkZGVkIHdoZW4gaW1wcm92aW5nIHR5cGluZyBmb3JcbiAgICAgICAqIHRoaXMgcGFyYW1ldGVycyAqL1xuICAgICAgcmV0dXJuIG1vZHVsZTtcbiAgICB9O1xuICB9XG5cbiAgZ2V0Q2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nKTogey4uLn0gfCBudWxsIHtcbiAgICBjb25zdCBnZXRWYWx1ZSA9IHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXNbbmFtZV07XG4gICAgcmV0dXJuIGdldFZhbHVlID8gZ2V0VmFsdWUoKSA6IG51bGw7XG4gIH1cblxuICBjYWxsTmF0aXZlU3luY0hvb2soXG4gICAgbW9kdWxlSUQ6IG51bWJlcixcbiAgICBtZXRob2RJRDogbnVtYmVyLFxuICAgIHBhcmFtczogbWl4ZWRbXSxcbiAgICBvbkZhaWw6ID8oLi4ubWl4ZWRbXSkgPT4gdm9pZCxcbiAgICBvblN1Y2M6ID8oLi4ubWl4ZWRbXSkgPT4gdm9pZCxcbiAgKTogbWl4ZWQge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIGdsb2JhbC5uYXRpdmVDYWxsU3luY0hvb2ssXG4gICAgICAgICdDYWxsaW5nIHN5bmNocm9ub3VzIG1ldGhvZHMgb24gbmF0aXZlICcgK1xuICAgICAgICAgICdtb2R1bGVzIGlzIG5vdCBzdXBwb3J0ZWQgaW4gQ2hyb21lLlxcblxcbiBDb25zaWRlciBwcm92aWRpbmcgYWx0ZXJuYXRpdmUgJyArXG4gICAgICAgICAgJ21ldGhvZHMgdG8gZXhwb3NlIHRoaXMgbWV0aG9kIGluIGRlYnVnIG1vZGUsIGUuZy4gYnkgZXhwb3NpbmcgY29uc3RhbnRzICcgK1xuICAgICAgICAgICdhaGVhZC1vZi10aW1lLicsXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnByb2Nlc3NDYWxsYmFja3MobW9kdWxlSUQsIG1ldGhvZElELCBwYXJhbXMsIG9uRmFpbCwgb25TdWNjKTtcbiAgICByZXR1cm4gZ2xvYmFsLm5hdGl2ZUNhbGxTeW5jSG9vayhtb2R1bGVJRCwgbWV0aG9kSUQsIHBhcmFtcyk7XG4gIH1cblxuICBwcm9jZXNzQ2FsbGJhY2tzKFxuICAgIG1vZHVsZUlEOiBudW1iZXIsXG4gICAgbWV0aG9kSUQ6IG51bWJlcixcbiAgICBwYXJhbXM6IG1peGVkW10sXG4gICAgb25GYWlsOiA/KC4uLm1peGVkW10pID0+IHZvaWQsXG4gICAgb25TdWNjOiA/KC4uLm1peGVkW10pID0+IHZvaWQsXG4gICk6IHZvaWQge1xuICAgIGlmIChvbkZhaWwgfHwgb25TdWNjKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEXSA9IFttb2R1bGVJRCwgbWV0aG9kSURdO1xuICAgICAgICBpZiAodGhpcy5fY2FsbElEID4gREVCVUdfSU5GT19MSU1JVCkge1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEIC0gREVCVUdfSU5GT19MSU1JVF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3Muc2l6ZSA+IDUwMCkge1xuICAgICAgICAgIGNvbnN0IGluZm8gPSB7fTtcbiAgICAgICAgICB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzLmZvckVhY2goKF8sIGNhbGxJRCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGVidWcgPSB0aGlzLl9kZWJ1Z0luZm9bY2FsbElEXTtcbiAgICAgICAgICAgIGNvbnN0IG1vZHVsZSA9IGRlYnVnICYmIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW2RlYnVnWzBdXTtcbiAgICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGRlYnVnICYmIHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW2RlYnVnWzBdXVtkZWJ1Z1sxXV07XG4gICAgICAgICAgICBpbmZvW2NhbGxJRF0gPSB7bW9kdWxlLCBtZXRob2R9O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHdhcm5PbmNlKFxuICAgICAgICAgICAgJ2V4Y2Vzc2l2ZS1udW1iZXItb2YtcGVuZGluZy1jYWxsYmFja3MnLFxuICAgICAgICAgICAgYFBsZWFzZSByZXBvcnQ6IEV4Y2Vzc2l2ZSBudW1iZXIgb2YgcGVuZGluZyBjYWxsYmFja3M6ICR7XG4gICAgICAgICAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3Muc2l6ZVxuICAgICAgICAgICAgfS4gU29tZSBwZW5kaW5nIGNhbGxiYWNrcyB0aGF0IG1pZ2h0IGhhdmUgbGVha2VkIGJ5IG5ldmVyIGJlaW5nIGNhbGxlZCBmcm9tIG5hdGl2ZSBjb2RlOiAke3N0cmluZ2lmeVNhZmUoXG4gICAgICAgICAgICAgIGluZm8sXG4gICAgICAgICAgICApfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gRW5jb2RlIGNhbGxJRHMgaW50byBwYWlycyBvZiBjYWxsYmFjayBpZGVudGlmaWVycyBieSBzaGlmdGluZyBsZWZ0IGFuZCB1c2luZyB0aGUgcmlnaHRtb3N0IGJpdFxuICAgICAgLy8gdG8gaW5kaWNhdGUgZmFpbCAoMCkgb3Igc3VjY2VzcyAoMSlcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgICBvbkZhaWwgJiYgcGFyYW1zLnB1c2godGhpcy5fY2FsbElEIDw8IDEpO1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgIG9uU3VjYyAmJiBwYXJhbXMucHVzaCgodGhpcy5fY2FsbElEIDw8IDEpIHwgMSk7XG4gICAgICB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzLnNldCh0aGlzLl9jYWxsSUQsIG9uU3VjYyk7XG4gICAgICB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzLnNldCh0aGlzLl9jYWxsSUQsIG9uRmFpbCk7XG4gICAgfVxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyAmJlxuICAgICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jRmxvdyhcbiAgICAgICAgICBUUkFDRV9UQUdfUkVBQ1RfQVBQUyxcbiAgICAgICAgICAnbmF0aXZlJyxcbiAgICAgICAgICB0aGlzLl9jYWxsSUQsXG4gICAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX2NhbGxJRCsrO1xuICB9XG5cbiAgZW5xdWV1ZU5hdGl2ZUNhbGwoXG4gICAgbW9kdWxlSUQ6IG51bWJlcixcbiAgICBtZXRob2RJRDogbnVtYmVyLFxuICAgIHBhcmFtczogbWl4ZWRbXSxcbiAgICBvbkZhaWw6ID8oLi4ubWl4ZWRbXSkgPT4gdm9pZCxcbiAgICBvblN1Y2M6ID8oLi4ubWl4ZWRbXSkgPT4gdm9pZCxcbiAgKSB7XG4gICAgdGhpcy5wcm9jZXNzQ2FsbGJhY2tzKG1vZHVsZUlELCBtZXRob2RJRCwgcGFyYW1zLCBvbkZhaWwsIG9uU3VjYyk7XG5cbiAgICB0aGlzLl9xdWV1ZVtNT0RVTEVfSURTXS5wdXNoKG1vZHVsZUlEKTtcbiAgICB0aGlzLl9xdWV1ZVtNRVRIT0RfSURTXS5wdXNoKG1ldGhvZElEKTtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAvLyBWYWxpZGF0ZSB0aGF0IHBhcmFtZXRlcnMgcGFzc2VkIG92ZXIgdGhlIGJyaWRnZSBhcmVcbiAgICAgIC8vIGZvbGx5LWNvbnZlcnRpYmxlLiAgQXMgYSBzcGVjaWFsIGNhc2UsIGlmIGEgcHJvcCB2YWx1ZSBpcyBhXG4gICAgICAvLyBmdW5jdGlvbiBpdCBpcyBwZXJtaXR0ZWQgaGVyZSwgYW5kIHNwZWNpYWwtY2FzZWQgaW4gdGhlXG4gICAgICAvLyBjb252ZXJzaW9uLlxuICAgICAgY29uc3QgaXNWYWxpZEFyZ3VtZW50ID0gdmFsID0+IHtcbiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsKSB7XG4gICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgIHJldHVybiBpc0Zpbml0ZSh2YWwpO1xuICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICBpZiAodmFsID09IG51bGwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbC5ldmVyeShpc1ZhbGlkQXJndW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGsgaW4gdmFsKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsW2tdICE9PSAnZnVuY3Rpb24nICYmICFpc1ZhbGlkQXJndW1lbnQodmFsW2tdKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gUmVwbGFjZW1lbnQgYWxsb3dzIG5vcm1hbGx5IG5vbi1KU09OLWNvbnZlcnRpYmxlIHZhbHVlcyB0byBiZVxuICAgICAgLy8gc2Vlbi4gIFRoZXJlIGlzIGFtYmlndWl0eSB3aXRoIHN0cmluZyB2YWx1ZXMsIGJ1dCBpbiBjb250ZXh0LFxuICAgICAgLy8gaXQgc2hvdWxkIGF0IGxlYXN0IGJlIGEgc3Ryb25nIGhpbnQuXG4gICAgICBjb25zdCByZXBsYWNlciA9IChrZXksIHZhbCkgPT4ge1xuICAgICAgICBjb25zdCB0ID0gdHlwZW9mIHZhbDtcbiAgICAgICAgaWYgKHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gJzw8RnVuY3Rpb24gJyArIHZhbC5uYW1lICsgJz4+JztcbiAgICAgICAgfSBlbHNlIGlmICh0ID09PSAnbnVtYmVyJyAmJiAhaXNGaW5pdGUodmFsKSkge1xuICAgICAgICAgIHJldHVybiAnPDwnICsgdmFsLnRvU3RyaW5nKCkgKyAnPj4nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIE5vdGUgdGhhdCBKU09OLnN0cmluZ2lmeVxuICAgICAgaW52YXJpYW50KFxuICAgICAgICBpc1ZhbGlkQXJndW1lbnQocGFyYW1zKSxcbiAgICAgICAgJyVzIGlzIG5vdCB1c2FibGUgYXMgYSBuYXRpdmUgbWV0aG9kIGFyZ3VtZW50JyxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkocGFyYW1zLCByZXBsYWNlciksXG4gICAgICApO1xuXG4gICAgICAvLyBUaGUgcGFyYW1zIG9iamVjdCBzaG91bGQgbm90IGJlIG11dGF0ZWQgYWZ0ZXIgYmVpbmcgcXVldWVkXG4gICAgICBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYocGFyYW1zKTtcbiAgICB9XG4gICAgdGhpcy5fcXVldWVbUEFSQU1TXS5wdXNoKHBhcmFtcyk7XG5cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGlmIChcbiAgICAgIGdsb2JhbC5uYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlICYmXG4gICAgICBub3cgLSB0aGlzLl9sYXN0Rmx1c2ggPj0gTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TXG4gICAgKSB7XG4gICAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgdGhpcy5fY2FsbElEXTtcbiAgICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5vdztcbiAgICAgIGdsb2JhbC5uYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlKHF1ZXVlKTtcbiAgICB9XG4gICAgU3lzdHJhY2UuY291bnRlckV2ZW50KCdwZW5kaW5nX2pzX3RvX25hdGl2ZV9xdWV1ZScsIHRoaXMuX3F1ZXVlWzBdLmxlbmd0aCk7XG4gICAgaWYgKF9fREVWX18gJiYgdGhpcy5fX3NweSAmJiBpc0Zpbml0ZShtb2R1bGVJRCkpIHtcbiAgICAgIHRoaXMuX19zcHkoe1xuICAgICAgICB0eXBlOiBUT19OQVRJVkUsXG4gICAgICAgIG1vZHVsZTogdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdLFxuICAgICAgICBtZXRob2Q6IHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXVttZXRob2RJRF0sXG4gICAgICAgIGFyZ3M6IHBhcmFtcyxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fX3NweSkge1xuICAgICAgdGhpcy5fX3NweSh7XG4gICAgICAgIHR5cGU6IFRPX05BVElWRSxcbiAgICAgICAgbW9kdWxlOiBtb2R1bGVJRCArICcnLFxuICAgICAgICBtZXRob2Q6IG1ldGhvZElELFxuICAgICAgICBhcmdzOiBwYXJhbXMsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVEZWJ1Z0xvb2t1cChcbiAgICBtb2R1bGVJRDogbnVtYmVyLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBtZXRob2RzOiA/JFJlYWRPbmx5QXJyYXk8c3RyaW5nPixcbiAgKSB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW21vZHVsZUlEXSA9IG5hbWU7XG4gICAgICB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVttb2R1bGVJRF0gPSBtZXRob2RzIHx8IFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZvciBKU1RpbWVycyB0byByZWdpc3RlciBpdHMgY2FsbGJhY2suIE90aGVyd2lzZSBhIGNpcmN1bGFyIGRlcGVuZGVuY3lcbiAgLy8gYmV0d2VlbiBtb2R1bGVzIGlzIGludHJvZHVjZWQuIE5vdGUgdGhhdCBvbmx5IG9uZSBjYWxsYmFjayBtYXkgYmVcbiAgLy8gcmVnaXN0ZXJlZCBhdCBhIHRpbWUuXG4gIHNldFJlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fcmVhY3ROYXRpdmVNaWNyb3Rhc2tzQ2FsbGJhY2sgPSBmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1ldGhvZHNcbiAgICovXG5cbiAgX19ndWFyZChmbjogKCkgPT4gdm9pZCkge1xuICAgIGlmICh0aGlzLl9fc2hvdWxkUGF1c2VPblRocm93KCkpIHtcbiAgICAgIGZuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZuKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBFcnJvclV0aWxzLnJlcG9ydEZhdGFsRXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIE1lc3NhZ2VRdWV1ZSBpbnN0YWxscyBhIGdsb2JhbCBoYW5kbGVyIHRvIGNhdGNoIGFsbCBleGNlcHRpb25zIHdoZXJlIEpTIHVzZXJzIGNhbiByZWdpc3RlciB0aGVpciBvd24gYmVoYXZpb3JcbiAgLy8gVGhpcyBoYW5kbGVyIG1ha2VzIGFsbCBleGNlcHRpb25zIHRvIGJlIHByb3BhZ2F0ZWQgZnJvbSBpbnNpZGUgTWVzc2FnZVF1ZXVlIHJhdGhlciB0aGFuIGJ5IHRoZSBWTSBhdCB0aGVpciBvcmlnaW5cbiAgLy8gVGhpcyBtYWtlcyBzdGFja3RyYWNlcyB0byBiZSBwbGFjZWQgYXQgTWVzc2FnZVF1ZXVlIHJhdGhlciB0aGFuIGF0IHdoZXJlIHRoZXkgd2VyZSBsYXVuY2hlZFxuICAvLyBUaGUgcGFyYW1ldGVyIERlYnVnZ2VySW50ZXJuYWwuc2hvdWxkUGF1c2VPblRocm93IGlzIHVzZWQgdG8gY2hlY2sgYmVmb3JlIGNhdGNoaW5nIGFsbCBleGNlcHRpb25zIGFuZFxuICAvLyBjYW4gYmUgY29uZmlndXJlZCBieSB0aGUgVk0gb3IgYW55IEluc3BlY3RvclxuICBfX3Nob3VsZFBhdXNlT25UaHJvdygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgLy8gJEZsb3dGaXhNZVtjYW5ub3QtcmVzb2x2ZS1uYW1lXVxuICAgICAgdHlwZW9mIERlYnVnZ2VySW50ZXJuYWwgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICBEZWJ1Z2dlckludGVybmFsLnNob3VsZFBhdXNlT25UaHJvdyA9PT0gdHJ1ZSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmXG4gICAgKTtcbiAgfVxuXG4gIF9fY2FsbFJlYWN0TmF0aXZlTWljcm90YXNrcygpIHtcbiAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KCdKU1RpbWVycy5jYWxsUmVhY3ROYXRpdmVNaWNyb3Rhc2tzKCknKTtcbiAgICBpZiAodGhpcy5fcmVhY3ROYXRpdmVNaWNyb3Rhc2tzQ2FsbGJhY2sgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fcmVhY3ROYXRpdmVNaWNyb3Rhc2tzQ2FsbGJhY2soKTtcbiAgICB9XG4gICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgfVxuXG4gIF9fY2FsbEZ1bmN0aW9uKG1vZHVsZTogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgYXJnczogbWl4ZWRbXSk6IHZvaWQge1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IERhdGUubm93KCk7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gdGhpcy5fbGFzdEZsdXNoO1xuICAgIGlmIChfX0RFVl9fIHx8IHRoaXMuX19zcHkpIHtcbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYCR7bW9kdWxlfS4ke21ldGhvZH0oJHtzdHJpbmdpZnlTYWZlKGFyZ3MpfSlgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgU3lzdHJhY2UuYmVnaW5FdmVudChgJHttb2R1bGV9LiR7bWV0aG9kfSguLi4pYCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5KHt0eXBlOiBUT19KUywgbW9kdWxlLCBtZXRob2QsIGFyZ3N9KTtcbiAgICB9XG4gICAgY29uc3QgbW9kdWxlTWV0aG9kcyA9IHRoaXMuZ2V0Q2FsbGFibGVNb2R1bGUobW9kdWxlKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHMsXG4gICAgICBgTW9kdWxlICR7bW9kdWxlfSBpcyBub3QgYSByZWdpc3RlcmVkIGNhbGxhYmxlIG1vZHVsZSAoY2FsbGluZyAke21ldGhvZH0pLiBBIGZyZXF1ZW50IGNhdXNlIG9mIHRoZSBlcnJvciBpcyB0aGF0IHRoZSBhcHBsaWNhdGlvbiBlbnRyeSBmaWxlIHBhdGggaXMgaW5jb3JyZWN0LlxuICAgICAgVGhpcyBjYW4gYWxzbyBoYXBwZW4gd2hlbiB0aGUgSlMgYnVuZGxlIGlzIGNvcnJ1cHQgb3IgdGhlcmUgaXMgYW4gZWFybHkgaW5pdGlhbGl6YXRpb24gZXJyb3Igd2hlbiBsb2FkaW5nIFJlYWN0IE5hdGl2ZS5gLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgISFtb2R1bGVNZXRob2RzW21ldGhvZF0sXG4gICAgICBgTWV0aG9kICR7bWV0aG9kfSBkb2VzIG5vdCBleGlzdCBvbiBtb2R1bGUgJHttb2R1bGV9YCxcbiAgICApO1xuICAgIG1vZHVsZU1ldGhvZHNbbWV0aG9kXS5hcHBseShtb2R1bGVNZXRob2RzLCBhcmdzKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICB9XG5cbiAgX19pbnZva2VDYWxsYmFjayhjYklEOiBudW1iZXIsIGFyZ3M6IG1peGVkW10pIHtcbiAgICB0aGlzLl9sYXN0Rmx1c2ggPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IHRoaXMuX2xhc3RGbHVzaDtcblxuICAgIC8vIFRoZSByaWdodG1vc3QgYml0IG9mIGNiSUQgaW5kaWNhdGVzIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpLCB0aGUgb3RoZXIgYml0cyBhcmUgdGhlIGNhbGxJRCBzaGlmdGVkIGxlZnQuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICBjb25zdCBjYWxsSUQgPSBjYklEID4+PiAxO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgY29uc3QgaXNTdWNjZXNzID0gY2JJRCAmIDE7XG4gICAgY29uc3QgY2FsbGJhY2sgPSBpc1N1Y2Nlc3NcbiAgICAgID8gdGhpcy5fc3VjY2Vzc0NhbGxiYWNrcy5nZXQoY2FsbElEKVxuICAgICAgOiB0aGlzLl9mYWlsdXJlQ2FsbGJhY2tzLmdldChjYWxsSUQpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGNvbnN0IGRlYnVnID0gdGhpcy5fZGVidWdJbmZvW2NhbGxJRF07XG4gICAgICBjb25zdCBtb2R1bGUgPSBkZWJ1ZyAmJiB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZVtkZWJ1Z1swXV07XG4gICAgICBjb25zdCBtZXRob2QgPSBkZWJ1ZyAmJiB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVtkZWJ1Z1swXV1bZGVidWdbMV1dO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgYE5vIGNhbGxiYWNrIGZvdW5kIHdpdGggY2JJRCAke2NiSUR9IGFuZCBjYWxsSUQgJHtjYWxsSUR9IGZvciBgICtcbiAgICAgICAgICAobWV0aG9kXG4gICAgICAgICAgICA/IGAgJHttb2R1bGV9LiR7bWV0aG9kfSAtIG1vc3QgbGlrZWx5IHRoZSBjYWxsYmFjayB3YXMgYWxyZWFkeSBpbnZva2VkYFxuICAgICAgICAgICAgOiBgbW9kdWxlICR7bW9kdWxlIHx8ICc8dW5rbm93bj4nfWApICtcbiAgICAgICAgICBgLiBBcmdzOiAnJHtzdHJpbmdpZnlTYWZlKGFyZ3MpfSdgLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHByb2ZpbGVOYW1lID0gZGVidWdcbiAgICAgICAgPyAnPGNhbGxiYWNrIGZvciAnICsgbW9kdWxlICsgJy4nICsgbWV0aG9kICsgJz4nXG4gICAgICAgIDogY2JJRDtcbiAgICAgIGlmIChjYWxsYmFjayAmJiB0aGlzLl9fc3B5KSB7XG4gICAgICAgIHRoaXMuX19zcHkoe3R5cGU6IFRPX0pTLCBtb2R1bGU6IG51bGwsIG1ldGhvZDogcHJvZmlsZU5hbWUsIGFyZ3N9KTtcbiAgICAgIH1cbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoXG4gICAgICAgIGBNZXNzYWdlUXVldWUuaW52b2tlQ2FsbGJhY2soJHtwcm9maWxlTmFtZX0sICR7c3RyaW5naWZ5U2FmZShhcmdzKX0pYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3MuZGVsZXRlKGNhbGxJRCk7XG4gICAgdGhpcy5fZmFpbHVyZUNhbGxiYWNrcy5kZWxldGUoY2FsbElEKTtcbiAgICBjYWxsYmFjayguLi5hcmdzKTtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IE1lc3NhZ2VRdWV1ZTtcbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsbUJBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGdCQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBRyxhQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFFYixJQUFNSSxVQUFVLEdBQUdKLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQztBQUN2RCxJQUFNSyxRQUFRLEdBQUdMLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQztBQUVuRCxJQUFNTSxpQ0FBaUMsR0FBR04sT0FBTyxDQUFDLGdEQUFnRCxDQUFDO0FB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