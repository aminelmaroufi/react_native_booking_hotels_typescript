{"version":3,"names":["_interopRequireDefault","require","_invariant","oneArgumentPooler","copyFieldsFrom","Klass","instancePool","length","instance","pop","call","twoArgumentPooler","a1","a2","threeArgumentPooler","a3","fourArgumentPooler","a4","standardReleaser","invariant","destructor","poolSize","push","DEFAULT_POOL_SIZE","DEFAULT_POOLER","addPoolingTo","CopyConstructor","pooler","NewKlass","getPooled","release","PooledClass","module","exports"],"sources":["PooledClass.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\nimport invariant from 'invariant';\n\n/**\n * Static poolers. Several custom versions for each potential number of\n * arguments. A completely generic pooler is easy to implement, but would\n * require accessing the `arguments` object. In each of these, `this` refers to\n * the Class itself, not an instance. If any others are needed, simply add them\n * here, or in their own files.\n */\nconst oneArgumentPooler = function(copyFieldsFrom) {\n  const Klass = this;\n  if (Klass.instancePool.length) {\n    const instance = Klass.instancePool.pop();\n    Klass.call(instance, copyFieldsFrom);\n    return instance;\n  } else {\n    return new Klass(copyFieldsFrom);\n  }\n};\n\nconst twoArgumentPooler = function(a1, a2) {\n  const Klass = this;\n  if (Klass.instancePool.length) {\n    const instance = Klass.instancePool.pop();\n    Klass.call(instance, a1, a2);\n    return instance;\n  } else {\n    return new Klass(a1, a2);\n  }\n};\n\nconst threeArgumentPooler = function(a1, a2, a3) {\n  const Klass = this;\n  if (Klass.instancePool.length) {\n    const instance = Klass.instancePool.pop();\n    Klass.call(instance, a1, a2, a3);\n    return instance;\n  } else {\n    return new Klass(a1, a2, a3);\n  }\n};\n\nconst fourArgumentPooler = function(a1, a2, a3, a4) {\n  const Klass = this;\n  if (Klass.instancePool.length) {\n    const instance = Klass.instancePool.pop();\n    Klass.call(instance, a1, a2, a3, a4);\n    return instance;\n  } else {\n    return new Klass(a1, a2, a3, a4);\n  }\n};\n\nconst standardReleaser = function(instance) {\n  const Klass = this;\n  invariant(\n    instance instanceof Klass,\n    'Trying to release an instance into a pool of a different type.',\n  );\n  instance.destructor();\n  if (Klass.instancePool.length < Klass.poolSize) {\n    Klass.instancePool.push(instance);\n  }\n};\n\nconst DEFAULT_POOL_SIZE = 10;\nconst DEFAULT_POOLER = oneArgumentPooler;\n\ntype Pooler = any;\n\n/**\n * Augments `CopyConstructor` to be a poolable class, augmenting only the class\n * itself (statically) not adding any prototypical fields. Any CopyConstructor\n * you give this may have a `poolSize` property, and will look for a\n * prototypical `destructor` on instances.\n *\n * @param {Function} CopyConstructor Constructor that can be used to reset.\n * @param {Function} pooler Customizable pooler.\n */\nconst addPoolingTo = function<T>(\n  CopyConstructor: Class<T>,\n  pooler: Pooler,\n): Class<T> & {\n  getPooled(\n    ...args: $ReadOnlyArray<mixed>\n  ): /* arguments of the constructor */ T,\n  release(instance: mixed): void,\n  ...\n} {\n  // Casting as any so that flow ignores the actual implementation and trusts\n  // it to match the type we declared\n  const NewKlass = (CopyConstructor: any);\n  NewKlass.instancePool = [];\n  NewKlass.getPooled = pooler || DEFAULT_POOLER;\n  if (!NewKlass.poolSize) {\n    NewKlass.poolSize = DEFAULT_POOL_SIZE;\n  }\n  NewKlass.release = standardReleaser;\n  return NewKlass;\n};\n\nconst PooledClass = {\n  addPoolingTo: addPoolingTo,\n  oneArgumentPooler: (oneArgumentPooler: Pooler),\n  twoArgumentPooler: (twoArgumentPooler: Pooler),\n  threeArgumentPooler: (threeArgumentPooler: Pooler),\n  fourArgumentPooler: (fourArgumentPooler: Pooler),\n};\n\nmodule.exports = PooledClass;\n"],"mappings":"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"}