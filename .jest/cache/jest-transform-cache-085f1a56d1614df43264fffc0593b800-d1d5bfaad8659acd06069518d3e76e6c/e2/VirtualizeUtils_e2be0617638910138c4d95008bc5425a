60de9c4296c265a2e0f8bdacb83d0343
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.computeWindowedRenderLimits = computeWindowedRenderLimits;
exports.elementsThatOverlapOffsets = elementsThatOverlapOffsets;
exports.keyExtractor = keyExtractor;
exports.newRangeCount = newRangeCount;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _invariant = _interopRequireDefault(require("invariant"));
function elementsThatOverlapOffsets(offsets, itemCount, getFrameMetrics) {
  var out = [];
  var outLength = 0;
  for (var ii = 0; ii < itemCount; ii++) {
    var frame = getFrameMetrics(ii);
    var trailingOffset = frame.offset + frame.length;
    for (var kk = 0; kk < offsets.length; kk++) {
      if (out[kk] == null && trailingOffset >= offsets[kk]) {
        out[kk] = ii;
        outLength++;
        if (kk === offsets.length - 1) {
          (0, _invariant.default)(outLength === offsets.length, 'bad offsets input, should be in increasing order: %s', JSON.stringify(offsets));
          return out;
        }
      }
    }
  }
  return out;
}
function newRangeCount(prev, next) {
  return next.last - next.first + 1 - Math.max(0, 1 + Math.min(next.last, prev.last) - Math.max(next.first, prev.first));
}
function computeWindowedRenderLimits(data, getItemCount, maxToRenderPerBatch, windowSize, prev, getFrameMetricsApprox, scrollMetrics) {
  var itemCount = getItemCount(data);
  if (itemCount === 0) {
    return prev;
  }
  var offset = scrollMetrics.offset,
    velocity = scrollMetrics.velocity,
    visibleLength = scrollMetrics.visibleLength;
  var visibleBegin = Math.max(0, offset);
  var visibleEnd = visibleBegin + visibleLength;
  var overscanLength = (windowSize - 1) * visibleLength;
  var leadFactor = 0.5;
  var fillPreference = velocity > 1 ? 'after' : velocity < -1 ? 'before' : 'none';
  var overscanBegin = Math.max(0, visibleBegin - (1 - leadFactor) * overscanLength);
  var overscanEnd = Math.max(0, visibleEnd + leadFactor * overscanLength);
  var lastItemOffset = getFrameMetricsApprox(itemCount - 1).offset;
  if (lastItemOffset < overscanBegin) {
    return {
      first: Math.max(0, itemCount - 1 - maxToRenderPerBatch),
      last: itemCount - 1
    };
  }
  var _elementsThatOverlapO = elementsThatOverlapOffsets([overscanBegin, visibleBegin, visibleEnd, overscanEnd], itemCount, getFrameMetricsApprox),
    _elementsThatOverlapO2 = (0, _slicedToArray2.default)(_elementsThatOverlapO, 4),
    overscanFirst = _elementsThatOverlapO2[0],
    first = _elementsThatOverlapO2[1],
    last = _elementsThatOverlapO2[2],
    overscanLast = _elementsThatOverlapO2[3];
  overscanFirst = overscanFirst == null ? 0 : overscanFirst;
  first = first == null ? Math.max(0, overscanFirst) : first;
  overscanLast = overscanLast == null ? itemCount - 1 : overscanLast;
  last = last == null ? Math.min(overscanLast, first + maxToRenderPerBatch - 1) : last;
  var visible = {
    first: first,
    last: last
  };
  var newCellCount = newRangeCount(prev, visible);
  while (true) {
    if (first <= overscanFirst && last >= overscanLast) {
      break;
    }
    var maxNewCells = newCellCount >= maxToRenderPerBatch;
    var firstWillAddMore = first <= prev.first || first > prev.last;
    var firstShouldIncrement = first > overscanFirst && (!maxNewCells || !firstWillAddMore);
    var lastWillAddMore = last >= prev.last || last < prev.first;
    var lastShouldIncrement = last < overscanLast && (!maxNewCells || !lastWillAddMore);
    if (maxNewCells && !firstShouldIncrement && !lastShouldIncrement) {
      break;
    }
    if (firstShouldIncrement && !(fillPreference === 'after' && lastShouldIncrement && lastWillAddMore)) {
      if (firstWillAddMore) {
        newCellCount++;
      }
      first--;
    }
    if (lastShouldIncrement && !(fillPreference === 'before' && firstShouldIncrement && firstWillAddMore)) {
      if (lastWillAddMore) {
        newCellCount++;
      }
      last++;
    }
  }
  if (!(last >= first && first >= 0 && last < itemCount && first >= overscanFirst && last <= overscanLast && first <= visible.first && last >= visible.last)) {
    throw new Error('Bad window calculation ' + JSON.stringify({
      first: first,
      last: last,
      itemCount: itemCount,
      overscanFirst: overscanFirst,
      overscanLast: overscanLast,
      visible: visible
    }));
  }
  return {
    first: first,
    last: last
  };
}
function keyExtractor(item, index) {
  if (typeof item === 'object' && (item == null ? void 0 : item.key) != null) {
    return item.key;
  }
  if (typeof item === 'object' && (item == null ? void 0 : item.id) != null) {
    return item.id;
  }
  return String(index);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY29tcHV0ZVdpbmRvd2VkUmVuZGVyTGltaXRzIiwiZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMiLCJrZXlFeHRyYWN0b3IiLCJuZXdSYW5nZUNvdW50IiwiX3NsaWNlZFRvQXJyYXkyIiwiX2ludmFyaWFudCIsIm9mZnNldHMiLCJpdGVtQ291bnQiLCJnZXRGcmFtZU1ldHJpY3MiLCJvdXQiLCJvdXRMZW5ndGgiLCJpaSIsImZyYW1lIiwidHJhaWxpbmdPZmZzZXQiLCJvZmZzZXQiLCJsZW5ndGgiLCJrayIsImludmFyaWFudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwcmV2IiwibmV4dCIsImxhc3QiLCJmaXJzdCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJkYXRhIiwiZ2V0SXRlbUNvdW50IiwibWF4VG9SZW5kZXJQZXJCYXRjaCIsIndpbmRvd1NpemUiLCJnZXRGcmFtZU1ldHJpY3NBcHByb3giLCJzY3JvbGxNZXRyaWNzIiwidmVsb2NpdHkiLCJ2aXNpYmxlTGVuZ3RoIiwidmlzaWJsZUJlZ2luIiwidmlzaWJsZUVuZCIsIm92ZXJzY2FuTGVuZ3RoIiwibGVhZEZhY3RvciIsImZpbGxQcmVmZXJlbmNlIiwib3ZlcnNjYW5CZWdpbiIsIm92ZXJzY2FuRW5kIiwibGFzdEl0ZW1PZmZzZXQiLCJfZWxlbWVudHNUaGF0T3ZlcmxhcE8iLCJfZWxlbWVudHNUaGF0T3ZlcmxhcE8yIiwiZGVmYXVsdCIsIm92ZXJzY2FuRmlyc3QiLCJvdmVyc2Nhbkxhc3QiLCJ2aXNpYmxlIiwibmV3Q2VsbENvdW50IiwibWF4TmV3Q2VsbHMiLCJmaXJzdFdpbGxBZGRNb3JlIiwiZmlyc3RTaG91bGRJbmNyZW1lbnQiLCJsYXN0V2lsbEFkZE1vcmUiLCJsYXN0U2hvdWxkSW5jcmVtZW50IiwiRXJyb3IiLCJpdGVtIiwiaW5kZXgiLCJrZXkiLCJpZCIsIlN0cmluZyJdLCJzb3VyY2VzIjpbIlZpcnR1YWxpemVVdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2ludmFyaWFudCc7XG5cbi8qKlxuICogVXNlZCB0byBmaW5kIHRoZSBpbmRpY2VzIG9mIHRoZSBmcmFtZXMgdGhhdCBvdmVybGFwIHRoZSBnaXZlbiBvZmZzZXRzLiBVc2VmdWwgZm9yIGZpbmRpbmcgdGhlXG4gKiBpdGVtcyB0aGF0IGJvdW5kIGRpZmZlcmVudCB3aW5kb3dzIG9mIGNvbnRlbnQsIHN1Y2ggYXMgdGhlIHZpc2libGUgYXJlYSBvciB0aGUgYnVmZmVyZWQgb3ZlcnNjYW5cbiAqIGFyZWEuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbGVtZW50c1RoYXRPdmVybGFwT2Zmc2V0cyhcbiAgb2Zmc2V0czogQXJyYXk8bnVtYmVyPixcbiAgaXRlbUNvdW50OiBudW1iZXIsXG4gIGdldEZyYW1lTWV0cmljczogKFxuICAgIGluZGV4OiBudW1iZXIsXG4gICkgPT4ge1xuICAgIGxlbmd0aDogbnVtYmVyLFxuICAgIG9mZnNldDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuKTogQXJyYXk8bnVtYmVyPiB7XG4gIGNvbnN0IG91dCA9IFtdO1xuICBsZXQgb3V0TGVuZ3RoID0gMDtcbiAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGl0ZW1Db3VudDsgaWkrKykge1xuICAgIGNvbnN0IGZyYW1lID0gZ2V0RnJhbWVNZXRyaWNzKGlpKTtcbiAgICBjb25zdCB0cmFpbGluZ09mZnNldCA9IGZyYW1lLm9mZnNldCArIGZyYW1lLmxlbmd0aDtcbiAgICBmb3IgKGxldCBrayA9IDA7IGtrIDwgb2Zmc2V0cy5sZW5ndGg7IGtrKyspIHtcbiAgICAgIGlmIChvdXRba2tdID09IG51bGwgJiYgdHJhaWxpbmdPZmZzZXQgPj0gb2Zmc2V0c1tra10pIHtcbiAgICAgICAgb3V0W2trXSA9IGlpO1xuICAgICAgICBvdXRMZW5ndGgrKztcbiAgICAgICAgaWYgKGtrID09PSBvZmZzZXRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICBvdXRMZW5ndGggPT09IG9mZnNldHMubGVuZ3RoLFxuICAgICAgICAgICAgJ2JhZCBvZmZzZXRzIGlucHV0LCBzaG91bGQgYmUgaW4gaW5jcmVhc2luZyBvcmRlcjogJXMnLFxuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkob2Zmc2V0cyksXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgYG5leHRgIHJhbmdlIHRoYXQgYXJlIG5ldyBjb21wYXJlZCB0byB0aGUgYHByZXZgIHJhbmdlLlxuICogSGFuZHkgZm9yIGNhbGN1bGF0aW5nIGhvdyBtYW55IG5ldyBpdGVtcyB3aWxsIGJlIHJlbmRlcmVkIHdoZW4gdGhlIHJlbmRlciB3aW5kb3cgY2hhbmdlcyBzbyB3ZVxuICogY2FuIHJlc3RyaWN0IHRoZSBudW1iZXIgb2YgbmV3IGl0ZW1zIHJlbmRlciBhdCBvbmNlIHNvIHRoYXQgY29udGVudCBjYW4gYXBwZWFyIG9uIHRoZSBzY3JlZW5cbiAqIGZhc3Rlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5ld1JhbmdlQ291bnQoXG4gIHByZXY6IHtcbiAgICBmaXJzdDogbnVtYmVyLFxuICAgIGxhc3Q6IG51bWJlcixcbiAgICAuLi5cbiAgfSxcbiAgbmV4dDoge1xuICAgIGZpcnN0OiBudW1iZXIsXG4gICAgbGFzdDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuKTogbnVtYmVyIHtcbiAgcmV0dXJuIChcbiAgICBuZXh0Lmxhc3QgLVxuICAgIG5leHQuZmlyc3QgK1xuICAgIDEgLVxuICAgIE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIDEgKyBNYXRoLm1pbihuZXh0Lmxhc3QsIHByZXYubGFzdCkgLSBNYXRoLm1heChuZXh0LmZpcnN0LCBwcmV2LmZpcnN0KSxcbiAgICApXG4gICk7XG59XG5cbi8qKlxuICogQ3VzdG9tIGxvZ2ljIGZvciBkZXRlcm1pbmluZyB3aGljaCBpdGVtcyBzaG91bGQgYmUgcmVuZGVyZWQgZ2l2ZW4gdGhlIGN1cnJlbnQgZnJhbWUgYW5kIHNjcm9sbFxuICogbWV0cmljcywgYXMgd2VsbCBhcyB0aGUgcHJldmlvdXMgcmVuZGVyIHN0YXRlLiBUaGUgYWxnb3JpdGhtIG1heSBldm9sdmUgb3ZlciB0aW1lLCBidXQgZ2VuZXJhbGx5XG4gKiBwcmlvcml0aXplcyB0aGUgdmlzaWJsZSBhcmVhIGZpcnN0LCB0aGVuIGV4cGFuZHMgdGhhdCB3aXRoIG92ZXJzY2FuIHJlZ2lvbnMgYWhlYWQgYW5kIGJlaGluZCxcbiAqIGJpYXNlZCBpbiB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyhcbiAgZGF0YTogYW55LFxuICBnZXRJdGVtQ291bnQ6IChkYXRhOiBhbnkpID0+IG51bWJlcixcbiAgbWF4VG9SZW5kZXJQZXJCYXRjaDogbnVtYmVyLFxuICB3aW5kb3dTaXplOiBudW1iZXIsXG4gIHByZXY6IHtcbiAgICBmaXJzdDogbnVtYmVyLFxuICAgIGxhc3Q6IG51bWJlcixcbiAgICAuLi5cbiAgfSxcbiAgZ2V0RnJhbWVNZXRyaWNzQXBwcm94OiAoXG4gICAgaW5kZXg6IG51bWJlcixcbiAgKSA9PiB7XG4gICAgbGVuZ3RoOiBudW1iZXIsXG4gICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgLi4uXG4gIH0sXG4gIHNjcm9sbE1ldHJpY3M6IHtcbiAgICBkdDogbnVtYmVyLFxuICAgIG9mZnNldDogbnVtYmVyLFxuICAgIHZlbG9jaXR5OiBudW1iZXIsXG4gICAgdmlzaWJsZUxlbmd0aDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuKToge1xuICBmaXJzdDogbnVtYmVyLFxuICBsYXN0OiBudW1iZXIsXG4gIC4uLlxufSB7XG4gIGNvbnN0IGl0ZW1Db3VudCA9IGdldEl0ZW1Db3VudChkYXRhKTtcbiAgaWYgKGl0ZW1Db3VudCA9PT0gMCkge1xuICAgIHJldHVybiBwcmV2O1xuICB9XG4gIGNvbnN0IHtvZmZzZXQsIHZlbG9jaXR5LCB2aXNpYmxlTGVuZ3RofSA9IHNjcm9sbE1ldHJpY3M7XG5cbiAgLy8gU3RhcnQgd2l0aCB2aXNpYmxlIGFyZWEsIHRoZW4gY29tcHV0ZSBtYXhpbXVtIG92ZXJzY2FuIHJlZ2lvbiBieSBleHBhbmRpbmcgZnJvbSB0aGVyZSwgYmlhc2VkXG4gIC8vIGluIHRoZSBkaXJlY3Rpb24gb2Ygc2Nyb2xsLiBUb3RhbCBvdmVyc2NhbiBhcmVhIGlzIGNhcHBlZCwgd2hpY2ggc2hvdWxkIGNhcCBtZW1vcnkgY29uc3VtcHRpb25cbiAgLy8gdG9vLlxuICBjb25zdCB2aXNpYmxlQmVnaW4gPSBNYXRoLm1heCgwLCBvZmZzZXQpO1xuICBjb25zdCB2aXNpYmxlRW5kID0gdmlzaWJsZUJlZ2luICsgdmlzaWJsZUxlbmd0aDtcbiAgY29uc3Qgb3ZlcnNjYW5MZW5ndGggPSAod2luZG93U2l6ZSAtIDEpICogdmlzaWJsZUxlbmd0aDtcblxuICAvLyBDb25zaWRlcmluZyB2ZWxvY2l0eSBzZWVtcyB0byBpbnRyb2R1Y2UgbW9yZSBjaHVybiB0aGFuIGl0J3Mgd29ydGguXG4gIGNvbnN0IGxlYWRGYWN0b3IgPSAwLjU7IC8vIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHZlbG9jaXR5IC8gMjUgKyAwLjUpKTtcblxuICBjb25zdCBmaWxsUHJlZmVyZW5jZSA9XG4gICAgdmVsb2NpdHkgPiAxID8gJ2FmdGVyJyA6IHZlbG9jaXR5IDwgLTEgPyAnYmVmb3JlJyA6ICdub25lJztcblxuICBjb25zdCBvdmVyc2NhbkJlZ2luID0gTWF0aC5tYXgoXG4gICAgMCxcbiAgICB2aXNpYmxlQmVnaW4gLSAoMSAtIGxlYWRGYWN0b3IpICogb3ZlcnNjYW5MZW5ndGgsXG4gICk7XG4gIGNvbnN0IG92ZXJzY2FuRW5kID0gTWF0aC5tYXgoMCwgdmlzaWJsZUVuZCArIGxlYWRGYWN0b3IgKiBvdmVyc2Nhbkxlbmd0aCk7XG5cbiAgY29uc3QgbGFzdEl0ZW1PZmZzZXQgPSBnZXRGcmFtZU1ldHJpY3NBcHByb3goaXRlbUNvdW50IC0gMSkub2Zmc2V0O1xuICBpZiAobGFzdEl0ZW1PZmZzZXQgPCBvdmVyc2NhbkJlZ2luKSB7XG4gICAgLy8gRW50aXJlIGxpc3QgaXMgYmVmb3JlIG91ciBvdmVyc2NhbiB3aW5kb3dcbiAgICByZXR1cm4ge1xuICAgICAgZmlyc3Q6IE1hdGgubWF4KDAsIGl0ZW1Db3VudCAtIDEgLSBtYXhUb1JlbmRlclBlckJhdGNoKSxcbiAgICAgIGxhc3Q6IGl0ZW1Db3VudCAtIDEsXG4gICAgfTtcbiAgfVxuXG4gIC8vIEZpbmQgdGhlIGluZGljZXMgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBpdGVtcyBhdCB0aGUgcmVuZGVyIGJvdW5kYXJpZXMgd2UncmUgdGFyZ2V0aW5nLlxuICBsZXQgW292ZXJzY2FuRmlyc3QsIGZpcnN0LCBsYXN0LCBvdmVyc2Nhbkxhc3RdID0gZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMoXG4gICAgW292ZXJzY2FuQmVnaW4sIHZpc2libGVCZWdpbiwgdmlzaWJsZUVuZCwgb3ZlcnNjYW5FbmRdLFxuICAgIGl0ZW1Db3VudCxcbiAgICBnZXRGcmFtZU1ldHJpY3NBcHByb3gsXG4gICk7XG4gIG92ZXJzY2FuRmlyc3QgPSBvdmVyc2NhbkZpcnN0ID09IG51bGwgPyAwIDogb3ZlcnNjYW5GaXJzdDtcbiAgZmlyc3QgPSBmaXJzdCA9PSBudWxsID8gTWF0aC5tYXgoMCwgb3ZlcnNjYW5GaXJzdCkgOiBmaXJzdDtcbiAgb3ZlcnNjYW5MYXN0ID0gb3ZlcnNjYW5MYXN0ID09IG51bGwgPyBpdGVtQ291bnQgLSAxIDogb3ZlcnNjYW5MYXN0O1xuICBsYXN0ID1cbiAgICBsYXN0ID09IG51bGxcbiAgICAgID8gTWF0aC5taW4ob3ZlcnNjYW5MYXN0LCBmaXJzdCArIG1heFRvUmVuZGVyUGVyQmF0Y2ggLSAxKVxuICAgICAgOiBsYXN0O1xuICBjb25zdCB2aXNpYmxlID0ge2ZpcnN0LCBsYXN0fTtcblxuICAvLyBXZSB3YW50IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgbmV3IGNlbGxzIHdlJ3JlIHJlbmRlcmluZyBwZXIgYmF0Y2ggc28gdGhhdCB3ZSBjYW4gZmlsbCB0aGVcbiAgLy8gY29udGVudCBvbiB0aGUgc2NyZWVuIHF1aWNrbHkuIElmIHdlIHJlbmRlcmVkIHRoZSBlbnRpcmUgb3ZlcnNjYW4gd2luZG93IGF0IG9uY2UsIHRoZSB1c2VyXG4gIC8vIGNvdWxkIGJlIHN0YXJpbmcgYXQgd2hpdGUgc3BhY2UgZm9yIGEgbG9uZyB0aW1lIHdhaXRpbmcgZm9yIGEgYnVuY2ggb2Ygb2Zmc2NyZWVuIGNvbnRlbnQgdG9cbiAgLy8gcmVuZGVyLlxuICBsZXQgbmV3Q2VsbENvdW50ID0gbmV3UmFuZ2VDb3VudChwcmV2LCB2aXNpYmxlKTtcblxuICB3aGlsZSAodHJ1ZSkge1xuICAgIGlmIChmaXJzdCA8PSBvdmVyc2NhbkZpcnN0ICYmIGxhc3QgPj0gb3ZlcnNjYW5MYXN0KSB7XG4gICAgICAvLyBJZiB3ZSBmaWxsIHRoZSBlbnRpcmUgb3ZlcnNjYW4gcmFuZ2UsIHdlJ3JlIGRvbmUuXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgbWF4TmV3Q2VsbHMgPSBuZXdDZWxsQ291bnQgPj0gbWF4VG9SZW5kZXJQZXJCYXRjaDtcbiAgICBjb25zdCBmaXJzdFdpbGxBZGRNb3JlID0gZmlyc3QgPD0gcHJldi5maXJzdCB8fCBmaXJzdCA+IHByZXYubGFzdDtcbiAgICBjb25zdCBmaXJzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBmaXJzdCA+IG92ZXJzY2FuRmlyc3QgJiYgKCFtYXhOZXdDZWxscyB8fCAhZmlyc3RXaWxsQWRkTW9yZSk7XG4gICAgY29uc3QgbGFzdFdpbGxBZGRNb3JlID0gbGFzdCA+PSBwcmV2Lmxhc3QgfHwgbGFzdCA8IHByZXYuZmlyc3Q7XG4gICAgY29uc3QgbGFzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBsYXN0IDwgb3ZlcnNjYW5MYXN0ICYmICghbWF4TmV3Q2VsbHMgfHwgIWxhc3RXaWxsQWRkTW9yZSk7XG4gICAgaWYgKG1heE5ld0NlbGxzICYmICFmaXJzdFNob3VsZEluY3JlbWVudCAmJiAhbGFzdFNob3VsZEluY3JlbWVudCkge1xuICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHN0b3AgaWYgd2UndmUgaGl0IG1heE5ld0NlbGxzIEFORCB3ZSBjYW5ub3QgaW5jcmVtZW50IGZpcnN0IG9yIGxhc3RcbiAgICAgIC8vIHdpdGhvdXQgcmVuZGVyaW5nIG5ldyBpdGVtcy4gVGhpcyBsZXQncyB1cyBwcmVzZXJ2ZSBhcyBtYW55IGFscmVhZHkgcmVuZGVyZWQgaXRlbXMgYXNcbiAgICAgIC8vIHBvc3NpYmxlLCByZWR1Y2luZyByZW5kZXIgY2h1cm4gYW5kIGtlZXBpbmcgdGhlIHJlbmRlcmVkIG92ZXJzY2FuIHJhbmdlIGFzIGxhcmdlIGFzXG4gICAgICAvLyBwb3NzaWJsZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBmaXJzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2FmdGVyJyAmJiBsYXN0U2hvdWxkSW5jcmVtZW50ICYmIGxhc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChmaXJzdFdpbGxBZGRNb3JlKSB7XG4gICAgICAgIG5ld0NlbGxDb3VudCsrO1xuICAgICAgfVxuICAgICAgZmlyc3QtLTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgbGFzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2JlZm9yZScgJiYgZmlyc3RTaG91bGRJbmNyZW1lbnQgJiYgZmlyc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChsYXN0V2lsbEFkZE1vcmUpIHtcbiAgICAgICAgbmV3Q2VsbENvdW50Kys7XG4gICAgICB9XG4gICAgICBsYXN0Kys7XG4gICAgfVxuICB9XG4gIGlmIChcbiAgICAhKFxuICAgICAgbGFzdCA+PSBmaXJzdCAmJlxuICAgICAgZmlyc3QgPj0gMCAmJlxuICAgICAgbGFzdCA8IGl0ZW1Db3VudCAmJlxuICAgICAgZmlyc3QgPj0gb3ZlcnNjYW5GaXJzdCAmJlxuICAgICAgbGFzdCA8PSBvdmVyc2Nhbkxhc3QgJiZcbiAgICAgIGZpcnN0IDw9IHZpc2libGUuZmlyc3QgJiZcbiAgICAgIGxhc3QgPj0gdmlzaWJsZS5sYXN0XG4gICAgKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQmFkIHdpbmRvdyBjYWxjdWxhdGlvbiAnICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGZpcnN0LFxuICAgICAgICAgIGxhc3QsXG4gICAgICAgICAgaXRlbUNvdW50LFxuICAgICAgICAgIG92ZXJzY2FuRmlyc3QsXG4gICAgICAgICAgb3ZlcnNjYW5MYXN0LFxuICAgICAgICAgIHZpc2libGUsXG4gICAgICAgIH0pLFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtmaXJzdCwgbGFzdH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlFeHRyYWN0b3IoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiBpdGVtID09PSAnb2JqZWN0JyAmJiBpdGVtPy5rZXkgIT0gbnVsbCkge1xuICAgIHJldHVybiBpdGVtLmtleTtcbiAgfVxuICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnICYmIGl0ZW0/LmlkICE9IG51bGwpIHtcbiAgICByZXR1cm4gaXRlbS5pZDtcbiAgfVxuICByZXR1cm4gU3RyaW5nKGluZGV4KTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUFDLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLDJCQUFBLEdBQUFBLDJCQUFBO0FBQUFGLE9BQUEsQ0FBQUcsMEJBQUEsR0FBQUEsMEJBQUE7QUFBQUgsT0FBQSxDQUFBSSxZQUFBLEdBQUFBLFlBQUE7QUFBQUosT0FBQSxDQUFBSyxhQUFBLEdBQUFBLGFBQUE7QUFBQSxJQUFBQyxlQUFBLEdBQUFWLHNCQUFBLENBQUFDLE9BQUE7QUFFYixJQUFBVSxVQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFPTyxTQUFTTSwwQkFBMEJBLENBQ3hDSyxPQUFzQixFQUN0QkMsU0FBaUIsRUFDakJDLGVBTUMsRUFDYztFQUNmLElBQU1DLEdBQUcsR0FBRyxFQUFFO0VBQ2QsSUFBSUMsU0FBUyxHQUFHLENBQUM7RUFDakIsS0FBSyxJQUFJQyxFQUFFLEdBQUcsQ0FBQyxFQUFFQSxFQUFFLEdBQUdKLFNBQVMsRUFBRUksRUFBRSxFQUFFLEVBQUU7SUFDckMsSUFBTUMsS0FBSyxHQUFHSixlQUFlLENBQUNHLEVBQUUsQ0FBQztJQUNqQyxJQUFNRSxjQUFjLEdBQUdELEtBQUssQ0FBQ0UsTUFBTSxHQUFHRixLQUFLLENBQUNHLE1BQU07SUFDbEQsS0FBSyxJQUFJQyxFQUFFLEdBQUcsQ0FBQyxFQUFFQSxFQUFFLEdBQUdWLE9BQU8sQ0FBQ1MsTUFBTSxFQUFFQyxFQUFFLEVBQUUsRUFBRTtNQUMxQyxJQUFJUCxHQUFHLENBQUNPLEVBQUUsQ0FBQyxJQUFJLElBQUksSUFBSUgsY0FBYyxJQUFJUCxPQUFPLENBQUNVLEVB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