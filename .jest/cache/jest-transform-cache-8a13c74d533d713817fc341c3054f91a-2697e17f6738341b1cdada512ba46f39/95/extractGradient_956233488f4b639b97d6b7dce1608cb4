642b562e9069c88d15a79b72a09c89ff
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = extractGradient;
var _react = _interopRequireWildcard(require("react"));
var _extractColor = _interopRequireDefault(require("./extractColor"));
var _extractOpacity = _interopRequireDefault(require("./extractOpacity"));
var _extractTransform = _interopRequireDefault(require("./extractTransform"));
var _units = _interopRequireDefault(require("../units"));
var percentReg = /^([+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)(%?)$/;
function percentToFloat(percent) {
  if (typeof percent === 'number') {
    return percent;
  }
  if (typeof percent === 'object' && typeof percent.__getAnimatedValue === 'function') {
    return percent.__getAnimatedValue();
  }
  var matched = typeof percent === 'string' && percent.match(percentReg);
  if (!matched) {
    console.warn("\"".concat(percent, "\" is not a valid number or percentage string."));
    return 0;
  }
  return matched[2] ? +matched[1] / 100 : +matched[1];
}
var offsetComparator = function offsetComparator(object, other) {
  return object[0] - other[0];
};
function extractGradient(props, parent) {
  var id = props.id,
    children = props.children,
    gradientTransform = props.gradientTransform,
    transform = props.transform,
    gradientUnits = props.gradientUnits;
  if (!id) {
    return null;
  }
  var stops = [];
  var childArray = children ? _react.Children.map(children, function (child) {
    return _react.default.cloneElement(child, {
      parent: parent
    });
  }) : [];
  var l = childArray.length;
  for (var i = 0; i < l; i++) {
    var _childArray$i$props = childArray[i].props,
      style = _childArray$i$props.style,
      _childArray$i$props$o = _childArray$i$props.offset,
      offset = _childArray$i$props$o === void 0 ? style && style.offset : _childArray$i$props$o,
      _childArray$i$props$s = _childArray$i$props.stopColor,
      stopColor = _childArray$i$props$s === void 0 ? style && style.stopColor || '#000' : _childArray$i$props$s,
      _childArray$i$props$s2 = _childArray$i$props.stopOpacity,
      stopOpacity = _childArray$i$props$s2 === void 0 ? style && style.stopOpacity : _childArray$i$props$s2;
    var offsetNumber = percentToFloat(offset || 0);
    var color = stopColor && (0, _extractColor.default)(stopColor);
    if (typeof color !== 'number' || isNaN(offsetNumber)) {
      console.warn("\"".concat(stopColor, "\" is not a valid color or \"").concat(offset, "\" is not a valid offset"));
      continue;
    }
    var alpha = Math.round((0, _extractOpacity.default)(stopOpacity) * 255);
    stops.push([offsetNumber, color & 0x00ffffff | alpha << 24]);
  }
  stops.sort(offsetComparator);
  var gradient = [];
  var k = stops.length;
  for (var j = 0; j < k; j++) {
    var s = stops[j];
    gradient.push(s[0], s[1]);
  }
  return {
    name: id,
    gradient: gradient,
    children: childArray,
    gradientUnits: gradientUnits && _units.default[gradientUnits] || 0,
    gradientTransform: (0, _extractTransform.default)(gradientTransform || transform || props)
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfZXh0cmFjdENvbG9yIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9leHRyYWN0T3BhY2l0eSIsIl9leHRyYWN0VHJhbnNmb3JtIiwiX3VuaXRzIiwicGVyY2VudFJlZyIsInBlcmNlbnRUb0Zsb2F0IiwicGVyY2VudCIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsIm1hdGNoZWQiLCJtYXRjaCIsImNvbnNvbGUiLCJ3YXJuIiwiY29uY2F0Iiwib2Zmc2V0Q29tcGFyYXRvciIsIm9iamVjdCIsIm90aGVyIiwiZXh0cmFjdEdyYWRpZW50IiwicHJvcHMiLCJwYXJlbnQiLCJpZCIsImNoaWxkcmVuIiwiZ3JhZGllbnRUcmFuc2Zvcm0iLCJ0cmFuc2Zvcm0iLCJncmFkaWVudFVuaXRzIiwic3RvcHMiLCJjaGlsZEFycmF5IiwiQ2hpbGRyZW4iLCJtYXAiLCJjaGlsZCIsImRlZmF1bHQiLCJjbG9uZUVsZW1lbnQiLCJsIiwibGVuZ3RoIiwiaSIsIl9jaGlsZEFycmF5JGkkcHJvcHMiLCJzdHlsZSIsIl9jaGlsZEFycmF5JGkkcHJvcHMkbyIsIm9mZnNldCIsIl9jaGlsZEFycmF5JGkkcHJvcHMkcyIsInN0b3BDb2xvciIsIl9jaGlsZEFycmF5JGkkcHJvcHMkczIiLCJzdG9wT3BhY2l0eSIsIm9mZnNldE51bWJlciIsImNvbG9yIiwiaXNOYU4iLCJhbHBoYSIsIk1hdGgiLCJyb3VuZCIsInB1c2giLCJzb3J0IiwiZ3JhZGllbnQiLCJrIiwiaiIsInMiLCJuYW1lIl0sInNvdXJjZXMiOlsiZXh0cmFjdEdyYWRpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDaGlsZHJlbiwgUmVhY3RFbGVtZW50IH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgZXh0cmFjdENvbG9yIGZyb20gJy4vZXh0cmFjdENvbG9yJztcbmltcG9ydCBleHRyYWN0T3BhY2l0eSBmcm9tICcuL2V4dHJhY3RPcGFjaXR5JztcbmltcG9ydCBleHRyYWN0VHJhbnNmb3JtIGZyb20gJy4vZXh0cmFjdFRyYW5zZm9ybSc7XG5pbXBvcnQgeyBUcmFuc2Zvcm1Qcm9wcyB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHVuaXRzIGZyb20gJy4uL3VuaXRzJztcblxuY29uc3QgcGVyY2VudFJlZyA9IC9eKFsrLV0/XFxkKyg/OlxcLlxcZCspPyg/OltlRV1bKy1dP1xcZCspPykoJT8pJC87XG5cbmZ1bmN0aW9uIHBlcmNlbnRUb0Zsb2F0KFxuICBwZXJjZW50OlxuICAgIHwgbnVtYmVyXG4gICAgfCBzdHJpbmdcbiAgICB8IHtcbiAgICAgICAgX19nZXRBbmltYXRlZFZhbHVlOiAoKSA9PiBudW1iZXI7XG4gICAgICB9LFxuKTogbnVtYmVyIHtcbiAgaWYgKHR5cGVvZiBwZXJjZW50ID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiBwZXJjZW50O1xuICB9XG4gIGlmIChcbiAgICB0eXBlb2YgcGVyY2VudCA9PT0gJ29iamVjdCcgJiZcbiAgICB0eXBlb2YgcGVyY2VudC5fX2dldEFuaW1hdGVkVmFsdWUgPT09ICdmdW5jdGlvbidcbiAgKSB7XG4gICAgcmV0dXJuIHBlcmNlbnQuX19nZXRBbmltYXRlZFZhbHVlKCk7XG4gIH1cbiAgY29uc3QgbWF0Y2hlZCA9IHR5cGVvZiBwZXJjZW50ID09PSAnc3RyaW5nJyAmJiBwZXJjZW50Lm1hdGNoKHBlcmNlbnRSZWcpO1xuICBpZiAoIW1hdGNoZWQpIHtcbiAgICBjb25zb2xlLndhcm4oYFwiJHtwZXJjZW50fVwiIGlzIG5vdCBhIHZhbGlkIG51bWJlciBvciBwZXJjZW50YWdlIHN0cmluZy5gKTtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIHJldHVybiBtYXRjaGVkWzJdID8gK21hdGNoZWRbMV0gLyAxMDAgOiArbWF0Y2hlZFsxXTtcbn1cblxuY29uc3Qgb2Zmc2V0Q29tcGFyYXRvciA9IChvYmplY3Q6IG51bWJlcltdLCBvdGhlcjogbnVtYmVyW10pID0+XG4gIG9iamVjdFswXSAtIG90aGVyWzBdO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBleHRyYWN0R3JhZGllbnQoXG4gIHByb3BzOiB7XG4gICAgaWQ/OiBzdHJpbmc7XG4gICAgY2hpbGRyZW4/OiBSZWFjdEVsZW1lbnRbXTtcbiAgICB0cmFuc2Zvcm0/OiBudW1iZXJbXSB8IHN0cmluZyB8IFRyYW5zZm9ybVByb3BzO1xuICAgIGdyYWRpZW50VHJhbnNmb3JtPzogbnVtYmVyW10gfCBzdHJpbmcgfCBUcmFuc2Zvcm1Qcm9wcztcbiAgICBncmFkaWVudFVuaXRzPzogJ29iamVjdEJvdW5kaW5nQm94JyB8ICd1c2VyU3BhY2VPblVzZSc7XG4gIH0gJiBUcmFuc2Zvcm1Qcm9wcyxcbiAgcGFyZW50OiB7fSxcbikge1xuICBjb25zdCB7IGlkLCBjaGlsZHJlbiwgZ3JhZGllbnRUcmFuc2Zvcm0sIHRyYW5zZm9ybSwgZ3JhZGllbnRVbml0cyB9ID0gcHJvcHM7XG4gIGlmICghaWQpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHN0b3BzID0gW107XG4gIGNvbnN0IGNoaWxkQXJyYXkgPSBjaGlsZHJlblxuICAgID8gQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCBjaGlsZCA9PlxuICAgICAgICBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGQsIHtcbiAgICAgICAgICBwYXJlbnQsXG4gICAgICAgIH0pLFxuICAgICAgKVxuICAgIDogW107XG4gIGNvbnN0IGwgPSBjaGlsZEFycmF5Lmxlbmd0aDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICBjb25zdCB7XG4gICAgICBwcm9wczoge1xuICAgICAgICBzdHlsZSxcbiAgICAgICAgb2Zmc2V0ID0gc3R5bGUgJiYgc3R5bGUub2Zmc2V0LFxuICAgICAgICBzdG9wQ29sb3IgPSAoc3R5bGUgJiYgc3R5bGUuc3RvcENvbG9yKSB8fCAnIzAwMCcsXG4gICAgICAgIHN0b3BPcGFjaXR5ID0gc3R5bGUgJiYgc3R5bGUuc3RvcE9wYWNpdHksXG4gICAgICB9LFxuICAgIH0gPSBjaGlsZEFycmF5W2ldO1xuICAgIGNvbnN0IG9mZnNldE51bWJlciA9IHBlcmNlbnRUb0Zsb2F0KG9mZnNldCB8fCAwKTtcbiAgICBjb25zdCBjb2xvciA9IHN0b3BDb2xvciAmJiBleHRyYWN0Q29sb3Ioc3RvcENvbG9yKTtcbiAgICBpZiAodHlwZW9mIGNvbG9yICE9PSAnbnVtYmVyJyB8fCBpc05hTihvZmZzZXROdW1iZXIpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBcIiR7c3RvcENvbG9yfVwiIGlzIG5vdCBhIHZhbGlkIGNvbG9yIG9yIFwiJHtvZmZzZXR9XCIgaXMgbm90IGEgdmFsaWQgb2Zmc2V0YCxcbiAgICAgICk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgYWxwaGEgPSBNYXRoLnJvdW5kKGV4dHJhY3RPcGFjaXR5KHN0b3BPcGFjaXR5KSAqIDI1NSk7XG4gICAgc3RvcHMucHVzaChbb2Zmc2V0TnVtYmVyLCAoY29sb3IgJiAweDAwZmZmZmZmKSB8IChhbHBoYSA8PCAyNCldKTtcbiAgfVxuICBzdG9wcy5zb3J0KG9mZnNldENvbXBhcmF0b3IpO1xuXG4gIGNvbnN0IGdyYWRpZW50ID0gW107XG4gIGNvbnN0IGsgPSBzdG9wcy5sZW5ndGg7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgazsgaisrKSB7XG4gICAgY29uc3QgcyA9IHN0b3BzW2pdO1xuICAgIGdyYWRpZW50LnB1c2goc1swXSwgc1sxXSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWU6IGlkLFxuICAgIGdyYWRpZW50LFxuICAgIGNoaWxkcmVuOiBjaGlsZEFycmF5LFxuICAgIGdyYWRpZW50VW5pdHM6IChncmFkaWVudFVuaXRzICYmIHVuaXRzW2dyYWRpZW50VW5pdHNdKSB8fCAwLFxuICAgIGdyYWRpZW50VHJhbnNmb3JtOiBleHRyYWN0VHJhbnNmb3JtKFxuICAgICAgZ3JhZGllbnRUcmFuc2Zvcm0gfHwgdHJhbnNmb3JtIHx8IHByb3BzLFxuICAgICksXG4gIH07XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUMsYUFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsZUFBQSxHQUFBRCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUksaUJBQUEsR0FBQUYsc0JBQUEsQ0FBQUYsT0FBQTtBQUVBLElBQUFLLE1BQUEsR0FBQUgsc0JBQUEsQ0FBQUYsT0FBQTtBQUVBLElBQU1NLFVBQVUsR0FBRyw2Q0FBbkI7QUFFQSxTQUFTQyxjQUFUQSxDQUNFQyxPQURGLEVBT1U7RUFDUixJQUFJLE9BQU9BLE9BQVAsS0FBbUIsUUFBdkIsRUFBaUM7SUFDL0IsT0FBT0EsT0FBUDtFQUNEO0VBQ0QsSUFDRSxPQUFPQSxPQUFQLEtBQW1CLFFBQW5CLElBQ0EsT0FBT0EsT0FBTyxDQUFDQyxrQkFBZixLQUFzQyxVQUZ4QyxFQUdFO0lBQ0EsT0FBT0QsT0FBTyxDQUFDQyxrQkFBUixFQUFQO0VBQ0Q7RUFDRCxJQUFNQyxPQUFPLEdBQUcsT0FBT0YsT0FBUCxLQUFtQixRQUFuQixJQUErQkEsT0FBTyxDQUFDRyxLQUFSLENBQWNMLFVBQWQsQ0FBL0M7RUFDQSxJQUFJLENBQUNJLE9BQUwsRUFBYztJQUNaRSxPQUFPLENBQUNDLElBQVIsTUFBQUMsTUFBQSxDQUFpQk4sT0FBakI7SUFDQSxPQUFPLENBQVA7RUFDRDtFQUVELE9BQU9FLE9BQU8sQ0FBQyxDQUFELENBQVAsR0FBYSxDQUFDQSxPQUFPLENBQUMsQ0FBRCxDQUFSLEdBQWMsR0FBM0IsR0FBaUMsQ0FBQ0EsT0FBTyxDQUFDLENBQUQsQ0FBaEQ7QUFDRDtBQUVELElBQU1LLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUJBLENBQUNDLE1BQUQsRUFBbUJDLEtBQW5CO0VBQUEsT0FDdkJELE1BQU0sQ0FBQyxDQUFELENBQU4sR0FBWUMsS0FBSyxDQUFDLENBQUQsQ0FETTtBQUFBLENBQXpCO0FBR2UsU0FBU0MsZUFBVEEsQ0FDYkMsS0FEYSxFQVFiQyxNQVJhLEVBU2I7RUFBQSxJQUNRQyxFQURSLEdBQ3NFRixLQUR0RSxDQUNRRSxFQURSO0lBQ1lDLFFBRFosR0FDc0VILEtBRHRFLENBQ1lHLFFBRFo7SUFDc0JDLGlCQUR0QixHQUNzRUosS0FEdEUsQ0FDc0JJLGlCQUR0QjtJQUN5Q0MsU0FEekMsR0FDc0VMLEtBRHRFLENBQ3lDSyxTQUR6QztJQUNvREMsYUFEcEQsR0FDc0VOLEtBRHRFLENBQ29ETSxhQURwRDtFQUVBLElBQUksQ0FBQ0osRUFBTCxFQUFTO0lBQ1AsT0FBTyxJQUFQO0VBQ0Q7RUFFRCxJQUFNSyxLQUFLLEdBQUcsRUFBZDtFQUNBLElBQU1DLFVBQVUsR0FBR0wsUUFBUSxHQUN2QnhCLE1BQUEsQ0FBQThCLFFBQUEsQ0FBU0MsR0FBVCxDQUFhUCxRQUFiLEVBQXVCLFVBQUFRLEtBQUs7SUFBQSxPQUMxQmhDLE1BQUEsQ0FBQWlDLE9BQUEsQ0FBTUMsWUFBTixDQUFtQkYsS0FBbkIsRUFBMEI7TUFDeEJWLE1BQU0sRUFBTkE7SUFEd0IsQ0FBMUIsQ0FEMEI7RUFBQSxDQUE1QixDQUR1QixHQU12QixFQU5KO0VBT0EsSUFBTWEsQ0FBQyxHQUFHTixVQUFVLENBQUNPLE1BQXJCO0VBQ0EsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRixDQUFwQixFQUF1QkUsQ0FBQyxFQUF4QixFQUE0QjtJQUFBLElBQUFDLG1CQUFBLEdBUXRCVCxVQUFVLENBQUNRLENBQUQsQ0FSWSxDQUV4QmhCLEtBRndCO01BR3RCa0IsS0FIc0IsR0FBQUQsbUJBQUEsQ0FHdEJDLEtBSHNCO01BQUFDLHFCQUFBLEdBQUFGLG1CQUFBLENBSXRCRyxNQUpzQjtNQUl0QkEsTUFKc0IsR0FBQUQscUJBQUEsY0FJYkQsS0FBSyxJQUFJQSxLQUFLLENBQUNFLE1BSkYsR0FBQUQscUJBQUE7TUFBQUUscUJBQUEsR0FBQUosbUJBQUEsQ0FLdEJLLFNBTHNCO01BS3RCQSxTQUxzQixHQUFBRCxxQkFBQSxjQUtUSCxLQUFLLElBQUlBLEtBQUssQ0FBQ0ksU0FBaEIsSUFBOEIsTUFMcEIsR0FBQUQscUJBQUE7TUFBQUUsc0JBQUEsR0FBQU4sbUJBQUEsQ0FNdEJPLFdBTnNCO01BTXRCQSxXQU5zQixHQUFBRCxzQkFBQSxjQU1STCxLQUFLLElBQUlBLEtBQUssQ0FBQ00sV0FOUCxHQUFBRCxzQkFBQTtJQVMxQixJQUFNRSxZQUFZLEdBQUdyQyxjQUFjLENBQUNnQyxNQUFNLElBQUksQ0FBWCxDQUFuQztJQUNBLElBQU1NLEtBQUssR0FBR0osU0FBUyxJQUFJLElBQUF4QyxhQUFBLENBQUE4QixPQUFBLEVBQWFVLFNBQWIsQ0FBM0I7SUFDQSxJQUFJLE9BQU9JLEtBQVAsS0FBaUIsUUFBakIsSUFBNkJDLEtBQUssQ0FBQ0YsWUFBRCxDQUF0QyxFQUFzRDtNQUNwRGhDLE9BQU8sQ0FBQ0MsSUFBUixNQUFBQyxNQUFBLENBQ00yQixTQUROLG1DQUFBM0IsTUFBQSxDQUM2Q3lCLE1BRDdDO01BR0E7SUFDRDtJQUNELElBQU1RLEtBQUssR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVcsSUFBQTlDLGVBQUEsQ0FBQTRCLE9BQUEsRUFBZVksV0FBZixJQUE4QixHQUF6QyxDQUFkO0lBQ0FqQixLQUFLLENBQUN3QixJQUFOLENBQVcsQ0FBQ04sWUFBRCxFQUFnQkMsS0FBSyxHQUFHLFVBQVQsR0FBd0JFLEtBQUssSUFBSSxFQUFoRCxDQUFYO0VBQ0Q7RUFDRHJCLEtBQUssQ0FBQ3lCLElBQU4sQ0FBV3BDLGdCQUFYO0VBRUEsSUFBTXFDLFFBQVEsR0FBRyxFQUFqQjtFQUNBLElBQU1DLENBQUMsR0FBRzNCLEtBQUssQ0FBQ1EsTUFBaEI7RUFDQSxLQUFLLElBQUlvQixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRCxDQUFwQixFQUF1QkMsQ0FBQyxFQUF4QixFQUE0QjtJQUMxQixJQUFNQyxDQUFDLEdBQUc3QixLQUFLLENBQUM0QixDQUFELENBQWY7SUFDQUYsUUFBUSxDQUFDRixJQUFULENBQWNLLENBQUMsQ0FBQyxDQUFELENBQWYsRUFBb0JBLENBQUMsQ0FBQyxDQUFELENBQXJCO0VBQ0Q7RUFFRCxPQUFPO0lBQ0xDLElBQUksRUFBRW5DLEVBREQ7SUFFTCtCLFFBQVEsRUFBUkEsUUFGSztJQUdMOUIsUUFBUSxFQUFFSyxVQUhMO0lBSUxGLGFBQWEsRUFBR0EsYUFBYSxJQUFJcEIsTUFBQSxDQUFBMEIsT0FBQSxDQUFNTixhQUFOLENBQWxCLElBQTJDLENBSnJEO0lBS0xGLGlCQUFpQixFQUFFLElBQUFuQixpQkFBQSxDQUFBMkIsT0FBQSxFQUNqQlIsaUJBQWlCLElBQUlDLFNBQXJCLElBQWtDTCxLQURqQjtFQUxkLENBQVA7QUFTRCJ9